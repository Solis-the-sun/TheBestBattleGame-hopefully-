<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solisâ€™ Battle Game</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background-color: #111;
    font-family: sans-serif;
    color: white;
  }
  #waveInfo {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 20px;
    color: #ccc;
    z-index: 10;
  }
  #coinInfo {
    position: absolute;
    top: 40px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 18px;
    color: gold;
    z-index: 10;
  }
  #upgradeInfo {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 18px;
    color: #ccc;
    z-index: 10;
  }
  canvas {
    display: block;
    margin: auto;
    border: 4px solid silver;
    background: url('https://i.imgur.com/4QfKuz1.jpg');
    background-size: cover;
  }
</style>
</head>
<body>
<div id="waveInfo">Wave: 1</div>
<div id="coinInfo">Coins: 0</div>
<div id="upgradeInfo">Upgrades - Power: 1 | Speed: 6</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let wave = 1;
let coins = 0;

const hero = {
  x: canvas.width/2,
  y: canvas.height/2,
  width: 20,
  height: 40,
  color: 'dodgerblue',
  projectiles: [],
  health: 100,
  maxHealth: 100,
  attackPower: 1,
  projectileSpeed: 6
};

let enemies = [];
let enemySpeedFactor = 1;

let droppedCoins = [];

const waveInfo = document.getElementById('waveInfo');
const coinInfo = document.getElementById('coinInfo');
const upgradeInfo = document.getElementById('upgradeInfo');

function spawnEnemies(count) {
  enemies = [];
  for (let i = 0; i < count; i++) {
    const edge = Math.floor(Math.random()*4);
    let x, y;
    switch(edge){
      case 0: x=0; y=Math.random()*canvas.height; break;
      case 1: x=canvas.width; y=Math.random()*canvas.height; break;
      case 2: x=Math.random()*canvas.width; y=0; break;
      case 3: x=Math.random()*canvas.width; y=canvas.height; break;
    }
    enemies.push({x, y, width: 20, height:40, color:'red', speed:1 + wave*0.2});
  }
}

function drawHero() {
  ctx.fillStyle = hero.color;
  // head
  ctx.beginPath();
  ctx.arc(hero.x, hero.y-hero.height/2, hero.width/2, 0, Math.PI*2);
  ctx.fill();
  // body
  ctx.fillRect(hero.x-hero.width/2, hero.y-hero.height/2+hero.width/2, hero.width, hero.height-hero.width/2);
  // arms
  ctx.fillRect(hero.x-hero.width, hero.y-hero.height/2+hero.width/2, hero.width, 5);
  ctx.fillRect(hero.x, hero.y-hero.height/2+hero.width/2, hero.width, 5);
  // legs
  ctx.fillRect(hero.x-hero.width/2, hero.y+hero.height/4, 5, hero.height/4);
  ctx.fillRect(hero.x+hero.width/2-5, hero.y+hero.height/4, 5, hero.height/4);
}

function drawEnemies() {
  enemies.forEach(e=>{
    ctx.fillStyle=e.color;
    // head
    ctx.beginPath();
    ctx.arc(e.x, e.y-e.height/2, e.width/2, 0, Math.PI*2);
    ctx.fill();
    // body
    ctx.fillRect(e.x-e.width/2, e.y-e.height/2+e.width/2, e.width, e.height-e.width/2);
    // arms
    ctx.fillRect(e.x-e.width, e.y-e.height/2+e.width/2, e.width, 5);
    ctx.fillRect(e.x, e.y-e.height/2+e.width/2, e.width, 5);
    // legs
    ctx.fillRect(e.x-e.width/2, e.y+e.height/4, 5, e.height/4);
    ctx.fillRect(e.x+e.width/2-5, e.y+e.height/4, 5, e.height/4);
  });
}

function moveEnemies() {
  enemies.forEach(e=>{
    const dx = hero.x - e.x;
    const dy = hero.y - e.y;
    const dist = Math.sqrt(dx*dx+dy*dy);
    e.x += (dx/dist)*(e.speed*enemySpeedFactor);
    e.y += (dy/dist)*(e.speed*enemySpeedFactor);
  });
}

function updateProjectiles(){
  hero.projectiles.forEach((p,i)=>{
    p.x += p.vx;
    p.y += p.vy;
    // check collision with enemies
    for(let j = enemies.length-1;j>=0;j--){
      let e = enemies[j];
      if(p.x>e.x-e.width/2 && p.x<e.x+e.width/2 && p.y>e.y-e.height/2 && p.y<e.y+e.height/2){
        enemies.splice(j,1);
        droppedCoins.push({x:e.x,y:e.y,amount:1});
      }
    }
    // remove projectile off screen
    if(p.x<0 || p.x>canvas.width || p.y<0 || p.y>canvas.height){
      hero.projectiles.splice(i,1);
    }
  });
}

function drawProjectiles(){
  ctx.fillStyle='cyan';
  hero.projectiles.forEach(p=>{
    ctx.beginPath();
    ctx.arc(p.x,p.y,5,0,Math.PI*2);
    ctx.fill();
  });
}

function drawCoins(){
  ctx.fillStyle='gold';
  droppedCoins.forEach(c=>{
    ctx.beginPath();
    ctx.arc(c.x,c.y,5,0,Math.PI*2);
    ctx.fill();
  });
}

function collectCoins(){
  droppedCoins = droppedCoins.filter(c=>{
    const dx = hero.x - c.x;
    const dy = hero.y - c.y;
    const dist = Math.sqrt(dx*dx+dy*dy);
    if(dist<30){
      coins += c.amount;
      coinInfo.innerText = "Coins: " + coins;
      return false;
    }
    return true;
  });
}

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  moveEnemies();
  updateProjectiles();
  collectCoins();
  drawHero();
  drawEnemies();
  drawProjectiles();
  drawCoins();

  if(enemies.length===0){
    wave++;
    waveInfo.innerText = "Wave: "+wave;
    hero.health = hero.maxHealth; // reset health
    spawnEnemies(5+wave*2);
    enemySpeedFactor += 0.05;
  }

  requestAnimationFrame(gameLoop);
}

// swipe attack
let startX=0,startY=0,dragging=false;

canvas.addEventListener('mousedown',e=>{
  startX=e.offsetX;
  startY=e.offsetY;
  dragging=true;
});

canvas.addEventListener('mouseup',e=>{
  if(!dragging) return;
  dragging=false;
  const dx = e.offsetX - startX;
  const dy = e.offsetY - startY;
  const mag = Math.sqrt(dx*dx+dy*dy);
  if(mag<10) return;
  const speed = hero.projectileSpeed;
  hero.projectiles.push({x:hero.x, y:hero.y, vx:dx/mag*speed, vy:dy/mag*speed});
});

canvas.addEventListener('touchstart',e=>{
  const t = e.touches[0];
  startX=t.clientX - canvas.offsetLeft;
  startY=t.clientY - canvas.offsetTop;
  dragging=true;
});

canvas.addEventListener('touchend',e=>{
  if(!dragging) return;
  dragging=false;
  const t = e.changedTouches[0];
  const dx = t.clientX-canvas.offsetLeft - startX;
  const dy = t.clientY-canvas.offsetTop - startY;
  const mag = Math.sqrt(dx*dx+dy*dy);
  if(mag<10) return;
  const speed = hero.projectileSpeed;
  hero.projectiles.push({x:hero.x, y:hero.y, vx:dx/mag*speed, vy:dy/mag*speed});
});

// upgrades via keyboard
document.addEventListener('keydown', e=>{
  if(e.key==='1' && coins>=5){
    hero.attackPower += 1;
    coins -=5;
  }
  if(e.key==='2' && coins>=5){
    hero.projectileSpeed += 1;
    coins -=5;
  }
  upgradeInfo.innerText = "Upgrades - Power: "+hero.attackPower+" | Speed: "+hero.projectileSpeed;
  coinInfo.innerText = "Coins: "+coins;
});

spawnEnemies(5);
gameLoop();
</script>
</body>
</html>
